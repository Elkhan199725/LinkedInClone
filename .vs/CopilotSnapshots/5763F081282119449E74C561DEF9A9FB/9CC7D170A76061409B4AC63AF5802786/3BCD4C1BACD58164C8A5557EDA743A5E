using Serilog;

var builder = WebApplication.CreateBuilder(args);

// 1. Setup Serilog (Daily Text File Logging)
// This creates the daily log file in the /Logs folder
Log.Logger = new LoggerConfiguration()
    .WriteTo.Console()
    .WriteTo.File("Logs/log-.txt", rollingInterval: RollingInterval.Day)
    .CreateLogger();

builder.Host.UseSerilog();

// 2. Add Services
builder.Services.AddControllers(); // Enables our Clean Architecture Controllers
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();  // Adds the Swagger Generator

// (Optional) Keep native OpenAPI if you want, but SwaggerGen covers it
// builder.Services.AddOpenApi(); 

var app = builder.Build();

// 3. Configure Pipeline
if (app.Environment.IsDevelopment())
{
    app.UseSwagger();   // Generates the JSON
    app.UseSwaggerUI(); // Generates the UI Page
}

app.UseHttpsRedirection();

app.UseAuthorization();

// 4. Map Controllers
// This tells the app to look for files like "AuthController.cs" 
// instead of writing code directly here.
app.MapControllers();

// Log startup
Log.Information("System Initialized. LinkedInClone API is starting up...");

app.Run();